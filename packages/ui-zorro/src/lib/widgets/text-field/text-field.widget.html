<ng-template let-control="control" let-schema="schema" let-model="model" [fluentContextGuard]="contextGuard">
  @let addonBefore = schema.addons?.before | reactive: model : schema : control | template;
  @let addonAfter = schema.addons?.after | reactive: model : schema : control | template;
  @let prefix = schema.affixes?.prefix | reactive: model : schema : control | template;
  @let suffix = schema.affixes?.suffix | reactive: model : schema : control | template;

  @if (ControlWrapperDirective | inject: { optional: true }) {
    @if (!(schema.hidden | reactive: model : schema : control)) {
      @if (schema.affixes || schema.addons || schema.clearable) {
        <nz-input-wrapper
          fluentCol
          [span]="schema.col | col: 'span'"
          [flex]="schema.col | col: 'flex'"
          [offset]="schema.col | col: 'offset'"
          [class]="schema.class"
          [style]="schema.style"
          [nzAllowClear]="schema.clearable">
          <input
            nz-input
            [attr.id]="schema.id"
            [attr.name]="schema.key"
            [attr.maxlength]="helper.length.max | invoke: schema.length"
            [attr.minlength]="helper.length.min | invoke: schema.length"
            [fluentBindingSchema]="schema"
            [fluentBindingControl]="control"
            [fluentBindingModel]="model"
            [formControl]="control"
            [placeholder]="(schema.placeholder | reactive: model : schema : control) ?? ''"
            [type]="schema.type ?? 'text'"
            [autofocus]="schema.autofocus"
            [readonly]="schema.readonly | reactive: model : schema : control"
            [nzSize]="schema.size!"
            [nzStatus]="(control | status)()"
            [nzBorderless]="schema.borderless" />
          @if (addonBefore) {
            <ng-template
              nzInputAddonBefore
              [fluentTemplateOutlet]="addonBefore"
              [fluentTemplateOutletContext]="{ control, schema, model }"
              >{{ addonBefore }}</ng-template
            >
          }
          @if (addonAfter) {
            <ng-template
              nzInputAddonAfter
              [fluentTemplateOutlet]="addonAfter"
              [fluentTemplateOutletContext]="{ control, schema, model }"
              >{{ addonAfter }}</ng-template
            >
          }
          @if (prefix) {
            <ng-template
              nzInputPrefix
              [fluentTemplateOutlet]="prefix"
              [fluentTemplateOutletContext]="{ control, schema, model }"
              >{{ prefix }}</ng-template
            >
          }
          @if (suffix) {
            <ng-template
              nzInputSuffix
              [fluentTemplateOutlet]="suffix"
              [fluentTemplateOutletContext]="{ control, schema, model }"
              >{{ suffix }}</ng-template
            >
          }
        </nz-input-wrapper>
      } @else {
        <input
          fluentCol
          nz-input
          [span]="schema.col | col: 'span'"
          [flex]="schema.col | col: 'flex'"
          [offset]="schema.col | col: 'offset'"
          [attr.id]="schema.id"
          [attr.name]="schema.key"
          [attr.maxlength]="helper.length.max | invoke: schema.length"
          [attr.minlength]="helper.length.min | invoke: schema.length"
          [fluentBindingSchema]="schema"
          [fluentBindingControl]="control"
          [fluentBindingModel]="model"
          [formControl]="control"
          [class]="schema.class"
          [style]="schema.style"
          [placeholder]="(schema.placeholder | reactive: model : schema : control) ?? ''"
          [type]="schema.type ?? 'text'"
          [autofocus]="schema.autofocus"
          [readonly]="schema.readonly | reactive: model : schema : control"
          [nzSize]="schema.size!"
          [nzStatus]="(control | status)()"
          [nzBorderless]="schema.borderless" />
      }
    }
  } @else {
    @if (schema.affixes || schema.addons || schema.clearable) {
      <nz-input-wrapper [class]="schema.class" [style]="schema.style" [nzAllowClear]="schema.clearable">
        <input
          nz-input
          [attr.id]="schema.id"
          [attr.name]="schema.key"
          [attr.maxlength]="helper.length.max | invoke: schema.length"
          [attr.minlength]="helper.length.min | invoke: schema.length"
          [fluentBindingSchema]="schema"
          [fluentBindingControl]="control"
          [fluentBindingModel]="model"
          [formControl]="control"
          [placeholder]="(schema.placeholder | reactive: model : schema : control) ?? ''"
          [type]="schema.type ?? 'text'"
          [autofocus]="schema.autofocus"
          [readonly]="schema.readonly | reactive: model : schema : control"
          [nzSize]="schema.size!"
          [nzStatus]="(control | status)()"
          [nzBorderless]="schema.borderless" />

        @if (addonBefore) {
          <ng-template
            nzInputAddonBefore
            [fluentTemplateOutlet]="addonBefore"
            [fluentTemplateOutletContext]="{ control, schema, model }"
            >{{ addonBefore }}</ng-template
          >
        }
        @if (addonAfter) {
          <ng-template
            nzInputAddonAfter
            [fluentTemplateOutlet]="addonAfter"
            [fluentTemplateOutletContext]="{ control, schema, model }"
            >{{ addonAfter }}</ng-template
          >
        }
        @if (prefix) {
          <ng-template
            nzInputPrefix
            [fluentTemplateOutlet]="prefix"
            [fluentTemplateOutletContext]="{ control, schema, model }"
            >{{ prefix }}</ng-template
          >
        }
        @if (suffix) {
          <ng-template
            nzInputSuffix
            [fluentTemplateOutlet]="suffix"
            [fluentTemplateOutletContext]="{ control, schema, model }"
            >{{ suffix }}</ng-template
          >
        }
      </nz-input-wrapper>
    } @else {
      <input
        nz-input
        [attr.id]="schema.id"
        [attr.name]="schema.key"
        [attr.maxlength]="helper.length.max | invoke: schema.length"
        [attr.minlength]="helper.length.min | invoke: schema.length"
        [fluentBindingSchema]="schema"
        [fluentBindingControl]="control"
        [fluentBindingModel]="model"
        [class]="schema.class"
        [style]="schema.style"
        [formControl]="control"
        [placeholder]="(schema.placeholder | reactive: model : schema : control) ?? ''"
        [type]="schema.type ?? 'text'"
        [autofocus]="schema.autofocus"
        [readonly]="schema.readonly | reactive: model : schema : control"
        [nzSize]="schema.size!"
        [nzStatus]="(control | status)()"
        [nzBorderless]="schema.borderless" />
    }
  }
</ng-template>
